
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomcatæ¶æ„å›¾å’Œæºç åˆ†æ</title>
    <style>
        body{
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .diagram-section {
            margin-bottom: 50px;
            padding: 30px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .diagram-section:hover {
            transform: translateY(-5px);
        }

        h2 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .architecture-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .server-box {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            width: 200px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .service-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .service-box {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            width: 250px;
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
        }

        .connector-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .connector-box {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            width: 180px;
            box-shadow: 0 8px 25px rgba(254, 202, 87, 0.3);
        }

        .engine-container {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .host-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .host-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            width: 200px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .context-box {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.3);
        }

        .arrow {
            font-size: 24px;
            color: #3498db;
            text-align: center;
            margin: 10px 0;
        }

        .source-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .component-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .component-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .component-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
        }

        .component-desc {
            line-height: 1.6;
            opacity: 0.9;
        }

        .feature-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .feature-list ul {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .feature-list li:before {
            content: "â–¶";
            color: #3498db;
            margin-right: 10px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #e17055;
        }

        /* å¯åŠ¨æµç¨‹æ ·å¼ */
        .startup-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
        }

        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
        }

        .step-box {
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            color: white;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .step-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .main-step {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .lifecycle-step {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .service-step {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .connector-step {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }

        .protocol-step {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #333;
        }

        .endpoint-step {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
        }

        .io-step {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            color: #333;
        }

        .step-desc {
            margin-top: 8px;
            font-size: 0.9em;
            color: #666;
            text-align: center;
            font-style: italic;
        }

        .lifecycle-phase {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed #dee2e6;
        }

        .sub-components {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .sub-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .arrow-small {
            font-size: 16px;
            color: #3498db;
        }

        .protocol-types {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .protocol-box {
            background: white;
            color: #333;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.8em;
            border: 2px solid #3498db;
        }

        .io-models {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .io-box {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            width: 200px;
            border: 2px solid #e74c3c;
        }

        .final-step {
            border: 3px solid #27ae60;
            padding: 20px;
            border-radius: 15px;
            background: #ecf0f1;
        }

        /* ä»£ç åˆ†ææ ·å¼ */
        .code-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .code-section {
            background: #2c3e50;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .code-section h3 {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.2em;
        }

        .code-card {
            background: #34495e;
            color: white;
            padding: 20px;
        }

        .code-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 15px;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 8px;
        }

        .code-content {
            line-height: 1.6;
        }

        .code-content code {
            background: #2c3e50;
            color: #e74c3c;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .code-content strong {
            color: #3498db;
        }

        /* æ—¶åºå›¾æ ·å¼ */
        .sequence-diagram {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .actors {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .actor {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            min-width: 100px;
            font-size: 0.9em;
        }

        .sequence-flows {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sequence-step {
            display: flex;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .sequence-arrow {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: bold;
            margin-right: 15px;
            min-width: 120px;
            text-align: center;
        }

        .sequence-desc {
            color: #2c3e50;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .service-container, .connector-container, .host-container {
                flex-direction: column;
                align-items: center;
            }
            
            .source-analysis {
                grid-template-columns: 1fr;
            }

            .code-analysis {
                grid-template-columns: 1fr;
            }

            .sub-components {
                flex-direction: column;
                align-items: center;
            }

            .protocol-types, .io-models {
                flex-direction: column;
                align-items: center;
            }

            .actors {
                justify-content: center;
            }

            .sequence-step {
                flex-direction: column;
                text-align: center;
            }

            .sequence-arrow {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Apache Tomcat æ¶æ„å›¾ä¸æºç åˆ†æ</h1>

        <!-- æ¶æ„å›¾éƒ¨åˆ† -->
        <div class="diagram-section">
            <h2>ğŸ—ï¸ Tomcat æ•´ä½“æ¶æ„å›¾</h2>
            <div class="architecture-diagram">
                <div class="server-box">
                    Server (æœåŠ¡å™¨)
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="service-container">
                    <div class="service-box">
                        Service (æœåŠ¡)<br>
                        <small>Catalina Service</small>
                    </div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="connector-container">
                    <div class="connector-box">
                        HTTP Connector<br>
                        <small>8080ç«¯å£</small>
                    </div>
                    <div class="connector-box">
                        HTTPS Connector<br>
                        <small>8443ç«¯å£</small>
                    </div>
                    <div class="connector-box">
                        AJP Connector<br>
                        <small>8009ç«¯å£</small>
                    </div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="engine-container">
                    <div style="text-align: center; font-weight: bold; color: #2c3e50; margin-bottom: 20px;">
                        Engine (å¼•æ“) - Catalina
                    </div>
                    
                    <div class="host-container">
                        <div class="host-box">
                            <div style="font-weight: bold;">Host (ä¸»æœº)</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">localhost</div>
                            
                            <div class="context-box" style="margin-top: 15px;">
                                Context (ä¸Šä¸‹æ–‡)<br>
                                <small>/app1</small>
                            </div>
                            <div class="context-box">
                                Context (ä¸Šä¸‹æ–‡)<br>
                                <small>/app2</small>
                            </div>
                        </div>
                        
                        <div class="host-box">
                            <div style="font-weight: bold;">Host (ä¸»æœº)</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">example.com</div>
                            
                            <div class="context-box" style="margin-top: 15px;">
                                Context (ä¸Šä¸‹æ–‡)<br>
                                <small>/webapp</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æºç åˆ†æéƒ¨åˆ† -->
        <div class="diagram-section">
            <h2>ğŸ” Tomcat æºç ç»„ä»¶åˆ†æ</h2>
            
            <div class="source-analysis">
                <div class="component-card">
                    <div class="component-title">Server ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.core.StandardServer<br><br>
                        <strong>èŒè´£ï¼š</strong>Tomcatçš„é¡¶å±‚å®¹å™¨ï¼Œä»£è¡¨æ•´ä¸ªServletå®¹å™¨ã€‚ç®¡ç†å…¨å±€èµ„æºã€ç”Ÿå‘½å‘¨æœŸï¼Œç›‘å¬å…³é—­ç«¯å£ã€‚<br><br>
                        <strong>å…³é”®æ–¹æ³•ï¼š</strong>
                        â€¢ start() - å¯åŠ¨æœåŠ¡å™¨<br>
                        â€¢ stop() - åœæ­¢æœåŠ¡å™¨<br>
                        â€¢ addService() - æ·»åŠ æœåŠ¡
                    </div>
                </div>

                <div class="component-card">
                    <div class="component-title">Service ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.core.StandardService<br><br>
                        <strong>èŒè´£ï¼š</strong>è¿æ¥Connectorå’ŒContainerçš„ä¸­é—´ç»„ä»¶ï¼Œå°†è¿æ¥å™¨æ¥æ”¶çš„è¯·æ±‚ä¼ é€’ç»™å®¹å™¨å¤„ç†ã€‚<br><br>
                        <strong>å…³é”®æ–¹æ³•ï¼š</strong>
                        â€¢ addConnector() - æ·»åŠ è¿æ¥å™¨<br>
                        â€¢ setContainer() - è®¾ç½®å®¹å™¨<br>
                        â€¢ mapperListener() - æ˜ å°„ç›‘å¬å™¨
                    </div>
                </div>

                <div class="component-card">
                    <div class="component-title">Connector ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.connector.Connector<br><br>
                        <strong>èŒè´£ï¼š</strong>å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œå°†Socketè¿æ¥è½¬æ¢ä¸ºRequestå’ŒResponseå¯¹è±¡ã€‚æ”¯æŒHTTPã€HTTPSã€AJPåè®®ã€‚<br><br>
                        <strong>å…³é”®ç»„ä»¶ï¼š</strong>
                        â€¢ ProtocolHandler - åè®®å¤„ç†å™¨<br>
                        â€¢ Endpoint - ç½‘ç»œç«¯ç‚¹<br>
                        â€¢ Processor - è¯·æ±‚å¤„ç†å™¨
                    </div>
                </div>

                <div class="component-card">
                    <div class="component-title">Engine ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.core.StandardEngine<br><br>
                        <strong>èŒè´£ï¼š</strong>Servletå®¹å™¨çš„é¡¶å±‚å®ç°ï¼Œå¤„ç†æ‰€æœ‰çš„è¯·æ±‚ã€‚å¯ä»¥åŒ…å«å¤šä¸ªHostï¼Œä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„Servletå¼•æ“ã€‚<br><br>
                        <strong>ç‰¹æ€§ï¼š</strong>
                        â€¢ é»˜è®¤Hosté…ç½®<br>
                        â€¢ è¯·æ±‚è·¯ç”±åˆ†å‘<br>
                        â€¢ é›†ç¾¤æ”¯æŒ
                    </div>
                </div>

                <div class="component-card">
                    <div class="component-title">Host ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.core.StandardHost<br><br>
                        <strong>èŒè´£ï¼š</strong>ä»£è¡¨è™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ªEngineå¯ä»¥åŒ…å«å¤šä¸ªHostã€‚æ¯ä¸ªHostå¯ä»¥æœ‰å¤šä¸ªContextï¼ˆWebåº”ç”¨ï¼‰ã€‚<br><br>
                        <strong>åŠŸèƒ½ï¼š</strong>
                        â€¢ åŸŸåæ˜ å°„<br>
                        â€¢ åº”ç”¨éƒ¨ç½²ç®¡ç†<br>
                        â€¢ è®¿é—®æ—¥å¿—è®°å½•
                    </div>
                </div>

                <div class="component-card">
                    <div class="component-title">Context ç»„ä»¶</div>
                    <div class="component-desc">
                        <strong>æ ¸å¿ƒç±»ï¼š</strong>org.apache.catalina.core.StandardContext<br><br>
                        <strong>èŒè´£ï¼š</strong>ä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ç¨‹åºï¼Œç®¡ç†è¯¥åº”ç”¨çš„æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬Servletã€Filterã€Listenerç­‰ã€‚<br><br>
                        <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>
                        â€¢ ServletContextå®ç°<br>
                        â€¢ ç±»åŠ è½½å™¨ç®¡ç†<br>
                        â€¢ ä¼šè¯ç®¡ç†
                    </div>
                </div>
            </div>
        </div>

        <!-- Tomcatå¯åŠ¨æµç¨‹éƒ¨åˆ† -->
        <div class="diagram-section">
            <h2>ğŸš€ Tomcat å¯åŠ¨æµç¨‹è¯¦è§£</h2>
            
            <div class="startup-flow">
                <div class="flow-step">
                    <div class="step-box main-step">Bootstrap.main()</div>
                    <div class="step-desc">JVMå¯åŠ¨å…¥å£ï¼Œè§£æå¯åŠ¨å‚æ•°</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box main-step">Bootstrap.load()</div>
                    <div class="step-desc">åŠ è½½Catalinaå®ä¾‹ï¼Œè®¾ç½®ç±»åŠ è½½å™¨</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box main-step">Catalina.load()</div>
                    <div class="step-desc">è§£æserver.xmlï¼Œåˆ›å»ºServerå®ä¾‹</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box main-step">Server.init()</div>
                    <div class="step-desc">åˆå§‹åŒ–Serverç»„ä»¶ï¼Œé€’å½’åˆå§‹åŒ–å­ç»„ä»¶</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box main-step">Lifecycle.init()</div>
                    <div class="step-desc">ç”Ÿå‘½å‘¨æœŸåˆå§‹åŒ–ï¼Œè§¦å‘BEFORE_INIT_EVENTäº‹ä»¶</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step lifecycle-phase">
                    <div class="step-box lifecycle-step">LifecycleBase.init()</div>
                    <div class="step-desc">æ ‡å‡†ç”Ÿå‘½å‘¨æœŸåŸºç±»åˆå§‹åŒ–</div>
                    
                    <div class="sub-components">
                        <div class="sub-flow">
                            <div class="step-box service-step">StandardService.initInternal()</div>
                            <div class="arrow-small">â¬‡ï¸</div>
                            <div class="step-box service-step">Service[].init()</div>
                            <div class="step-desc">åˆå§‹åŒ–æ‰€æœ‰Serviceç»„ä»¶</div>
                        </div>
                        
                        <div class="sub-flow">
                            <div class="step-box connector-step">Connector.init()</div>
                            <div class="step-desc">åˆå§‹åŒ–è¿æ¥å™¨ï¼Œåˆ›å»ºåè®®å¤„ç†å™¨</div>
                        </div>
                    </div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box protocol-step">ProtocolHandler.init()</div>
                    <div class="step-desc">åè®®å¤„ç†å™¨åˆå§‹åŒ–</div>
                    
                    <div class="protocol-types">
                        <div class="protocol-box">Http11NioProtocol</div>
                        <div class="protocol-box">Http11Nio2Protocol</div>
                        <div class="protocol-box">AjpNioProtocol</div>
                    </div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box protocol-step">AbstractProtocolHandler.init()</div>
                    <div class="step-desc">æŠ½è±¡åè®®å¤„ç†å™¨åˆå§‹åŒ–ï¼Œåˆ›å»ºEndpoint</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box endpoint-step">endpoint.init()</div>
                    <div class="step-desc">ç½‘ç»œç«¯ç‚¹åˆå§‹åŒ–ï¼Œç»‘å®šç«¯å£</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step">
                    <div class="step-box endpoint-step">bind()</div>
                    <div class="step-desc">ç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—ï¼Œç›‘å¬ç«¯å£</div>
                </div>
                
                <div class="arrow">â¬‡ï¸</div>
                
                <div class="flow-step final-step">
                    <div class="step-box io-step">BIO / NIO</div>
                    <div class="step-desc">é€‰æ‹©I/Oæ¨¡å‹ï¼Œå‡†å¤‡æ¥å—è¿æ¥</div>
                    
                    <div class="io-models">
                        <div class="io-box">
                            <strong>NIOæ¨¡å¼</strong><br>
                            <small>éé˜»å¡I/Oï¼Œé«˜å¹¶å‘æ”¯æŒ</small>
                        </div>
                        <div class="io-box">
                            <strong>NIO2æ¨¡å¼</strong><br>
                            <small>å¼‚æ­¥I/Oï¼Œæ›´é«˜æ€§èƒ½</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æºç çº§å¯åŠ¨åˆ†æ -->
        <div class="diagram-section">
            <h2>ğŸ” å¯åŠ¨æµç¨‹æºç åˆ†æ</h2>
            
            <div class="code-analysis">
                <div class="code-section">
                    <h3>1. Bootstrap å¯åŠ¨å¼•å¯¼</h3>
                    <div class="code-card">
                        <div class="code-title">Bootstrap.main() æ–¹æ³•åˆ†æ</div>
                        <div class="code-content">
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong><br>
                            â€¢ è§£æå‘½ä»¤è¡Œå‚æ•° (start, stop, configtest)<br>
                            â€¢ åˆå§‹åŒ–ç±»åŠ è½½å™¨ä½“ç³»<br>
                            â€¢ åˆ›å»º Catalina å®ä¾‹<br>
                            â€¢ è®¾ç½®å®‰å…¨ç®¡ç†å™¨<br><br>
                            
                            <strong>å…³é”®ä»£ç è·¯å¾„ï¼š</strong><br>
                            <code>Bootstrap â†’ init() â†’ load(args) â†’ start()</code>
                        </div>
                    </div>
                </div>

                <div class="code-section">
                    <h3>2. Catalina æ ¸å¿ƒåŠ è½½</h3>
                    <div class="code-card">
                        <div class="code-title">Catalina.load() æ–¹æ³•åˆ†æ</div>
                        <div class="code-content">
                            <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong><br>
                            â€¢ è§£æ server.xml é…ç½®æ–‡ä»¶<br>
                            â€¢ ä½¿ç”¨ Digester è§„åˆ™è§£æXML<br>
                            â€¢ åˆ›å»º Server å¯¹è±¡æ ‘ç»“æ„<br>
                            â€¢ è°ƒç”¨ Server.init() åˆå§‹åŒ–<br><br>
                            
                            <strong>XMLè§£æè§„åˆ™ï¼š</strong><br>
                            â€¢ Server â†’ Service â†’ Engine/Connector<br>
                            â€¢ Host â†’ Context â†’ Wrapper
                        </div>
                    </div>
                </div>

                <div class="code-section">
                    <h3>3. ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶</h3>
                    <div class="code-card">
                        <div class="code-title">LifecycleBase ç”Ÿå‘½å‘¨æœŸ</div>
                        <div class="code-content">
                            <strong>ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼š</strong><br>
                            â€¢ NEW â†’ INITIALIZING â†’ INITIALIZED<br>
                            â€¢ STARTING_PREP â†’ STARTING â†’ STARTED<br>
                            â€¢ STOPPING_PREP â†’ STOPPING â†’ STOPPED<br>
                            â€¢ DESTROYING â†’ DESTROYED<br><br>
                            
                            <strong>äº‹ä»¶æœºåˆ¶ï¼š</strong><br>
                            â€¢ BEFORE_INIT_EVENT / AFTER_INIT_EVENT<br>
                            â€¢ BEFORE_START_EVENT / AFTER_START_EVENT<br>
                            â€¢ CONFIGURE_START_EVENT
                        </div>
                    </div>
                </div>

                <div class="code-section">
                    <h3>4. Connector è¿æ¥å™¨åˆå§‹åŒ–</h3>
                    <div class="code-card">
                        <div class="code-title">Connector.initInternal() åˆ†æ</div>
                        <div class="code-content">
                            <strong>åˆå§‹åŒ–æ­¥éª¤ï¼š</strong><br>
                            â€¢ åˆ›å»º CoyoteAdapter é€‚é…å™¨<br>
                            â€¢ åˆå§‹åŒ– ProtocolHandler<br>
                            â€¢ è®¾ç½®è¯·æ±‚/å“åº”è§£æå™¨<br>
                            â€¢ é…ç½®SSL/TLSæ”¯æŒ<br><br>
                            
                            <strong>åè®®å¤„ç†å™¨ç±»å‹ï¼š</strong><br>
                            â€¢ HTTP/1.1: Http11NioProtocol<br>
                            â€¢ HTTP/2: Http2Protocol<br>
                            â€¢ AJP: AjpNioProtocol
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯åŠ¨æ—¶åºå›¾ -->
        <div class="diagram-section">
            <h2>ğŸ“Š å¯åŠ¨æ—¶åºå›¾</h2>
            
            <div class="sequence-diagram">
                <div class="actors">
                    <div class="actor">Bootstrap</div>
                    <div class="actor">Catalina</div>
                    <div class="actor">Server</div>
                    <div class="actor">Service</div>
                    <div class="actor">Connector</div>
                    <div class="actor">Endpoint</div>
                </div>
                
                <div class="sequence-flows">
                    <div class="sequence-step">
                        <div class="sequence-arrow">main() â†’</div>
                        <div class="sequence-desc">å¯åŠ¨JVM</div>
                    </div>
                    
                    <div class="sequence-step">
                        <div class="sequence-arrow">init() â†’</div>
                        <div class="sequence-desc">åˆå§‹åŒ–ç±»åŠ è½½å™¨</div>
                    </div>
                    
                    <div class="sequence-step">
                        <div class="sequence-arrow">load() â†’</div>
                        <div class="sequence-desc">è§£æserver.xml</div>
                    </div>
                    
                    <div class="sequence-step">
                        <div class="sequence-arrow">init() â†’</div>
                        <div class="sequence-desc">åˆå§‹åŒ–ç»„ä»¶æ ‘</div>
                    </div>
                    
                    <div class="sequence-step">
                        <div class="sequence-arrow">start() â†’</div>
                        <div class="sequence-desc">å¯åŠ¨æœåŠ¡</div>
                    </div>
                    
                    <div class="sequence-step">
                        <div class="sequence-arrow">bind() â†’</div>
                        <div class="sequence-desc">ç»‘å®šç«¯å£ç›‘å¬</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†è¯´æ˜éƒ¨åˆ† -->
        <div class="diagram-section">
            <h2>ğŸ“‹ æ¶æ„ç»„ä»¶è¯¦ç»†è¯´æ˜</h2>
            
            <div class="highlight-box">
                <h3>ğŸ”§ æ ¸å¿ƒè®¾è®¡æ¨¡å¼</h3>
                <p><strong>ç»„åˆæ¨¡å¼ï¼š</strong>Server â†’ Service â†’ Engine â†’ Host â†’ Context å½¢æˆæ ‘å½¢ç»“æ„</p>
                <p><strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼š</strong>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ç›‘å¬å’Œé€šçŸ¥æœºåˆ¶</p>
                <p><strong>è´£ä»»é“¾æ¨¡å¼ï¼š</strong>Pipelineå’ŒValveçš„è¯·æ±‚å¤„ç†é“¾</p>
            </div>

            <div class="feature-list">
                <h3>ğŸš€ è¯·æ±‚å¤„ç†æµç¨‹</h3>
                <ul>
                    <li>Connectoræ¥æ”¶HTTPè¯·æ±‚å¹¶è§£æ</li>
                    <li>CoyoteAdapterå°†è¯·æ±‚é€‚é…ä¸ºServletè§„èŒƒ</li>
                    <li>Engineé€šè¿‡Pipelineå¤„ç†è¯·æ±‚</li>
                    <li>Hostæ ¹æ®åŸŸåè·¯ç”±åˆ°ç›¸åº”è™šæ‹Ÿä¸»æœº</li>
                    <li>Contextå®šä½åˆ°å…·ä½“çš„Webåº”ç”¨</li>
                    <li>Wrapperæ‰¾åˆ°å¯¹åº”çš„Servletå®ä¾‹</li>
                    <li>æ‰§è¡ŒFilteré“¾å’ŒServletä¸šåŠ¡é€»è¾‘</li>
                    <li>è¿”å›å“åº”ç»“æœç»™å®¢æˆ·ç«¯</li>
                </ul>
            </div>

            <div class="feature-list">
                <h3>âš™ï¸ å…³é”®æŠ€æœ¯ç‰¹æ€§</h3>
                <ul>
                    <li><strong>NIOæ”¯æŒï¼š</strong>åŸºäºJava NIOçš„é«˜æ€§èƒ½ç½‘ç»œå¤„ç†</li>
                    <li><strong>ç±»åŠ è½½éš”ç¦»ï¼š</strong>æ¯ä¸ªWebåº”ç”¨ç‹¬ç«‹çš„ç±»åŠ è½½å™¨</li>
                    <li><strong>çƒ­éƒ¨ç½²ï¼š</strong>æ”¯æŒåº”ç”¨çš„åŠ¨æ€éƒ¨ç½²å’Œæ›´æ–°</li>
                    <li><strong>JMXç®¡ç†ï¼š</strong>å®Œæ•´çš„JMXç®¡ç†å’Œç›‘æ§æ”¯æŒ</li>
                    <li><strong>é›†ç¾¤æ”¯æŒï¼š</strong>æ”¯æŒä¼šè¯å¤åˆ¶å’Œè´Ÿè½½å‡è¡¡</li>
                    <li><strong>å®‰å…¨æ¡†æ¶ï¼š</strong>é›†æˆçš„è®¤è¯å’Œæˆæƒæœºåˆ¶</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h3>ğŸ“ é‡è¦é…ç½®æ–‡ä»¶</h3>
                <p><strong>server.xmlï¼š</strong>ä¸»é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰Serverã€Serviceã€Connectorã€Engineç­‰ç»„ä»¶</p>
                <p><strong>web.xmlï¼š</strong>Webåº”ç”¨éƒ¨ç½²æè¿°æ–‡ä»¶</p>
                <p><strong>context.xmlï¼š</strong>Contexté…ç½®æ–‡ä»¶</p>
                <p><strong>tomcat-users.xmlï¼š</strong>ç”¨æˆ·æƒé™é…ç½®</p>
            </div>
        </div>
    </div>
</body>
</html>